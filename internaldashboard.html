<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BuyCAN Internal Statistics Dashboard</title>
  <style>
    /* Canadian "Maple Leaf Red" as a primary accent color */
    :root {
      --canada-red: #D51900;
      --light-gray: #f9f9f9;
      --medium-gray: #e8e8e8;
    }

    body {
      font-family: "Arial", sans-serif;
      margin: 0;
      background-color: var(--light-gray);
      color: #333;
    }

    /* Header area with a maple leaf hint */
    .header {
      background-color: var(--canada-red);
      color: #fff;
      text-align: center;
      padding: 20px;
      margin-bottom: 20px;
    }
    .header h1 {
      margin: 0;
      font-size: 1.8rem;
      display: inline-block;
    }
    .leaf-icon {
      margin-left: 8px;
    }

    /* Container for main content */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px 40px 20px;
    }

    .input-section,
    .results-section {
      background: #fff;
      padding: 15px 20px;
      margin-bottom: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    /* Compact input form layout */
    .input-fields {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      align-items: center;
    }
    .input-section label {
      font-weight: bold;
      margin-right: 8px;
    }
    .input-section input[type="number"] {
      padding: 6px;
      width: 90px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-right: 10px;
    }
    .input-section button {
      padding: 10px 20px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background-color: var(--canada-red);
      color: #fff;
      font-size: 16px;
      margin-top: 10px;
    }
    .input-section button:hover {
      background-color: #b41500;
    }

    .error-message {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }

    /* Make total views more prominent */
    #big-views {
      text-align: center;
      font-size: 1.6em;
      font-weight: bold;
      margin-top: 0;
      margin-bottom: 0;
      color: var(--canada-red);
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .card {
      background: var(--medium-gray);
      border-radius: 5px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .card h3 {
      margin-top: 0;
      margin-bottom: 10px;
    }

    /* Date range heading spacing */
    .results-section h3 {
      margin-top: 15px;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>

<!-- Header with a subtle maple leaf reference -->
<div class="header">
  <h1>BuyCAN Internal Statistics Dashboard</h1>
  <span class="leaf-icon">üçÅ</span>
</div>

<div class="container">
  <div class="input-section">
    <div class="input-fields">
      <div>
        <label for="year">Year:</label>
        <input type="number" id="year" value="2025" />
      </div>

      <div>
        <label for="month">Month:</label>
        <input type="number" id="month" value="3" />
      </div>

      <div>
        <label for="day">Day:</label>
        <input type="number" id="day" value="14" />
      </div>

      <button id="fetchDataBtn">Fetch Stats</button>
    </div>
    <div class="error-message" id="errorMessage"></div>
  </div>

  <!-- Show total views big at the top -->
  <div class="results-section">
    <h2 id="big-views">Total Product Views: <span id="total_views">N/A</span></h2>
  </div>

  <div class="results-section">
    <h2>Results</h2>
    <div class="dashboard-grid">

      <!-- Cost Analysis Card -->
      <div class="card">
        <h3>Cost Analysis</h3>
        <p><strong>Average Cost:</strong> <span id="average_cost">N/A</span></p>
        <p><strong>Max Generation Cost:</strong> <span id="max_generation_cost">N/A</span></p>
        <p><strong>Total Cost:</strong> <span id="total_cost">N/A</span></p>
      </div>

      <!-- Generation Time Analysis Card -->
      <div class="card">
        <h3>Generation Time Analysis</h3>
        <p><strong>Average Time to Generate:</strong> <span id="average_time_to_generate">N/A</span></p>
        <p><strong>Max Generation Time:</strong> <span id="max_generation_time">N/A</span></p>
      </div>

      <!-- Product & Scan Info Card -->
      <div class="card">
        <h3>Product &amp; Scan Info</h3>
        <p><strong>New Products Generated:</strong> <span id="new_products_generated">N/A</span></p>
        <p><strong>Successful Scans:</strong> <span id="total_successful_scans">N/A</span></p>
        <p><strong>Failed Scans:</strong> <span id="total_failed_scans">N/A</span></p>
      </div>

      <!-- View Breakdown Card -->
      <div class="card">
        <h3>View Breakdown</h3>
        <p><strong>Total Scans:</strong> <span id="total_scans">N/A</span></p>
        <p><strong>Total Clicks:</strong> <span id="total_clicks">N/A</span></p>
      </div>

    </div>

    <h3>Date Range</h3>
    <p><strong>Start (UTC):</strong> <span id="date_start">N/A</span></p>
    <p><strong>End (UTC):</strong> <span id="date_end">N/A</span></p>
  </div>
</div>

<script>
  // Helper to format ISO date strings as something more human-readable (UTC)
  function formatUTCDate(dateString) {
    const dateObj = new Date(dateString);
    // e.g. "Fri, 14 Mar 2025 00:00:00 GMT"
    return dateObj.toUTCString();
  }

  document.getElementById('fetchDataBtn').addEventListener('click', function() {
    // Hard-coded auth token
    const authToken = 'PEEPEEPOOPOODOODOOKAKA';

    const year = document.getElementById('year').value.trim();
    const month = document.getElementById('month').value.trim();
    const day = document.getElementById('day').value.trim();
    const errorMessage = document.getElementById('errorMessage');

    // Clear any previous errors
    errorMessage.textContent = '';

    if (!year || !month || !day) {
      errorMessage.textContent = 'Please fill in the year, month, and day before fetching data.';
      return;
    }

    // Build the URL
    const url = `https://buycanadian.onrender.com/get-product-statistics?auth_token=${encodeURIComponent(authToken)}&year=${year}&month=${month}&day=${day}`;

    fetch(url)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok. Status: ' + response.status);
        }
        return response.json();
      })
      .then(data => {
        // Cost Analysis
        document.getElementById('average_cost').textContent = data.cost_analysis.average_cost;
        document.getElementById('max_generation_cost').textContent = data.cost_analysis.max_generation_cost;
        document.getElementById('total_cost').textContent = data.cost_analysis.total_cost;

        // Generation Time Analysis
        document.getElementById('average_time_to_generate').textContent = data.time_analysis.average_time_to_generate;
        document.getElementById('max_generation_time').textContent = data.time_analysis.max_generation_time;

        // Other Stats
        document.getElementById('new_products_generated').textContent = data.new_products_generated;
        document.getElementById('total_successful_scans').textContent = data.total_successful_scans;
        document.getElementById('total_failed_scans').textContent = data.total_failed_scans;

        // View Breakdown
        document.getElementById('total_scans').textContent = data.total_scans;
        document.getElementById('total_clicks').textContent = data.total_clicks;

        // Total Views (prominent at top)
        document.getElementById('total_views').textContent = data.total_views;

        // Date Range (formatted for UTC)
        document.getElementById('date_start').textContent = formatUTCDate(data.date_range.start);
        document.getElementById('date_end').textContent = formatUTCDate(data.date_range.end);
      })
      .catch(error => {
        errorMessage.textContent = 'Error fetching data: ' + error.message;
      });
  });
</script>

</body>
</html>
